# LognLook Database Documentation

Copyright 2025 LognLook  
Licensed under the Apache License, Version 2.0

## Overview

LognLook uses a hybrid database architecture combining MySQL for relational data and OpenSearch for log storage and search capabilities.

## Architecture

### MySQL (Relational Database)
- **Users**: User authentication and profile management
- **Projects**: Project management and settings
- **Troubles**: Troubleshooting reports and analysis
- **Notifications**: System and project notifications

### OpenSearch (Search Engine)
- **Log Storage**: Structured log data with vector embeddings
- **Full-text Search**: BM25 and semantic search capabilities
- **Analytics**: Log aggregations and time-series analysis

## Database Schema

### MySQL Tables

#### users
- Primary user authentication and profile data
- Fields: `id`, `username`, `password`, `create_at`

#### project
- Project configuration and metadata
- Fields: `id`, `name`, `description`, `index`, `api_key`, `invite_code`, `language`, `create_by`, `create_at`

#### user_project
- Many-to-many relationship between users and projects
- Fields: `id`, `user_id`, `project_id`, `role`, `email_notification`

#### troubles
- Troubleshooting reports generated by AI analysis
- Fields: `id`, `project_id`, `created_by`, `report_name`, `user_query`, `content`, `is_shared`, `created_at`

#### trouble_logs
- Links between trouble reports and related log entries
- Fields: `id`, `trouble_id`, `log_id`

#### project_settings
- Project-specific configuration (Logstash, keywords)
- Fields: `id`, `project_id`, `logstash_config`, `log_keywords`, `updated_at`

#### notifications
- System and project notifications
- Fields: `id`, `project_id`, `type`, `message`, `created_at`

### OpenSearch Index Mapping

The OpenSearch index stores log entries with the following key fields:

- **@timestamp**: Log entry timestamp
- **message**: Raw log message
- **level**: Log level (INFO, ERROR, WARN, DEBUG)
- **service**: Service/application name
- **environment**: Environment (dev, staging, prod)
- **project_id**: Associated project ID
- **vector**: 1536-dimensional embedding for semantic search
- **parsed_data**: Structured data extracted from logs
- **category**: AI-generated log category
- **comment**: AI-generated log analysis

## File Structure

```
docs/database/
├── README.md                 # This documentation
├── mysql/                    # MySQL schema definitions
│   ├── users.sql            # User table schema
│   ├── project.sql          # Project table schema
│   ├── user_project.sql     # User-project mapping
│   ├── troubles.sql         # Trouble reports table
│   ├── trouble_log.sql      # Trouble-log mapping
│   ├── project_setting.sql  # Project settings table
│   ├── notification.sql     # Notifications table
│   └── lognlook.vuerd.json  # Visual ERD diagram
└── opensearch/
    └── index-mapping.json   # OpenSearch field mappings
```

## Key Features

### Multi-tenancy
- Projects isolate data between different teams/applications
- Users can belong to multiple projects with different roles

### AI Integration
- Vector embeddings enable semantic search across logs
- GPT-4 generates troubleshooting reports and log categorization
- Hybrid search combines keyword and semantic matching

### Real-time Processing
- Logstash ingests logs via beats input
- Direct HTTP API for log submission
- Real-time indexing and search capabilities

## Development Notes

- All table names use snake_case (users, project, trouble_logs)
- Foreign keys include ON DELETE CASCADE for data consistency
- JSON fields store configuration and structured data
- OpenSearch uses cosine similarity for vector search
- Supports both Korean and English language processing

## Migration History

- **v1.0.0**: Initial schema with Elasticsearch
- **v1.1.0**: Migration from Elasticsearch to OpenSearch
- **v1.2.0**: Added vector search capabilities
- **v1.3.0**: Enhanced project settings and notifications

For implementation details, see the SQLAlchemy models in `server/app/models/`.